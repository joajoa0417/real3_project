<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB ë°ì´í„° í™•ì¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        .data-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .error {
            color: red;
            background: #ffe6e6;
            padding: 10px;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ—„ï¸ IndexedDB ë°ì´í„° í™•ì¸ ë„êµ¬</h1>
        
        <div class="controls">
            <button onclick="checkDatabase()">ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸</button>
            <button onclick="loadAllUsers()">ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ</button>
            <button onclick="loadAllStocks()">ëª¨ë“  ë³´ìœ ì¢…ëª© ì¡°íšŒ</button>
            <button onclick="loadAllTrades()">ëª¨ë“  ê±°ë˜ë‚´ì—­ ì¡°íšŒ</button>
            <button onclick="clearAllData()">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button>
        </div>

        <div id="status" class="data-section">
            <h2>ğŸ“Š ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ</h2>
            <pre id="statusContent">ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</pre>
        </div>

        <div id="users" class="data-section">
            <h2>ğŸ‘¥ ì‚¬ìš©ì ë°ì´í„°</h2>
            <pre id="usersContent">ì‚¬ìš©ì ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
        </div>

        <div id="stocks" class="data-section">
            <h2>ğŸ“ˆ ë³´ìœ ì¢…ëª© ë°ì´í„°</h2>
            <pre id="stocksContent">ë³´ìœ ì¢…ëª© ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
        </div>

        <div id="trades" class="data-section">
            <h2>ğŸ’± ê±°ë˜ë‚´ì—­ ë°ì´í„°</h2>
            <pre id="tradesContent">ê±°ë˜ë‚´ì—­ ë°ì´í„°ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</pre>
        </div>
    </div>

    <script>
        const DB_NAME = 'KiwoomyDB';
        const DB_VERSION = 1;
        let db = null;

        // ë°ì´í„°ë² ì´ìŠ¤ ì—´ê¸°
        async function openDatabase() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = () => reject(request.error);
                request.onsuccess = () => {
                    db = request.result;
                    resolve(db);
                };
            });
        }

        // ë°ì´í„°ë² ì´ìŠ¤ ìƒíƒœ í™•ì¸
        async function checkDatabase() {
            try {
                await openDatabase();
                const objectStores = Array.from(db.objectStoreNames);
                
                const status = {
                    database: DB_NAME,
                    version: db.version,
                    objectStores: objectStores,
                    connected: true,
                    timestamp: new Date().toLocaleString()
                };
                
                document.getElementById('statusContent').textContent = JSON.stringify(status, null, 2);
            } catch (error) {
                document.getElementById('statusContent').innerHTML = 
                    `<div class="error">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // ëª¨ë“  ì‚¬ìš©ì ì¡°íšŒ
        async function loadAllUsers() {
            try {
                if (!db) await openDatabase();
                
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const users = request.result;
                    document.getElementById('usersContent').textContent = 
                        JSON.stringify(users, null, 2);
                };
                
                request.onerror = () => {
                    document.getElementById('usersContent').innerHTML = 
                        `<div class="error">ì‚¬ìš©ì ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${request.error}</div>`;
                };
            } catch (error) {
                document.getElementById('usersContent').innerHTML = 
                    `<div class="error">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // ëª¨ë“  ë³´ìœ ì¢…ëª© ì¡°íšŒ
        async function loadAllStocks() {
            try {
                if (!db) await openDatabase();
                
                const transaction = db.transaction(['userStocks'], 'readonly');
                const store = transaction.objectStore('userStocks');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const stocks = request.result;
                    document.getElementById('stocksContent').textContent = 
                        JSON.stringify(stocks, null, 2);
                };
                
                request.onerror = () => {
                    document.getElementById('stocksContent').innerHTML = 
                        `<div class="error">ë³´ìœ ì¢…ëª© ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${request.error}</div>`;
                };
            } catch (error) {
                document.getElementById('stocksContent').innerHTML = 
                    `<div class="error">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // ëª¨ë“  ê±°ë˜ë‚´ì—­ ì¡°íšŒ
        async function loadAllTrades() {
            try {
                if (!db) await openDatabase();
                
                const transaction = db.transaction(['tradeHistory'], 'readonly');
                const store = transaction.objectStore('tradeHistory');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const trades = request.result;
                    document.getElementById('tradesContent').textContent = 
                        JSON.stringify(trades, null, 2);
                };
                
                request.onerror = () => {
                    document.getElementById('tradesContent').innerHTML = 
                        `<div class="error">ê±°ë˜ë‚´ì—­ ë°ì´í„° ì¡°íšŒ ì‹¤íŒ¨: ${request.error}</div>`;
                };
            } catch (error) {
                document.getElementById('tradesContent').innerHTML = 
                    `<div class="error">ì˜¤ë¥˜: ${error.message}</div>`;
            }
        }

        // ëª¨ë“  ë°ì´í„° ì‚­ì œ
        async function clearAllData() {
            if (!confirm('ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            try {
                if (db) {
                    db.close();
                }
                
                const deleteRequest = indexedDB.deleteDatabase(DB_NAME);
                
                deleteRequest.onsuccess = () => {
                    alert('ë°ì´í„°ë² ì´ìŠ¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    location.reload();
                };
                
                deleteRequest.onerror = () => {
                    alert('ë°ì´í„°ë² ì´ìŠ¤ ì‚­ì œ ì‹¤íŒ¨');
                };
            } catch (error) {
                alert(`ì˜¤ë¥˜: ${error.message}`);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ìƒíƒœ í™•ì¸
        window.addEventListener('load', checkDatabase);
    </script>
</body>
</html> 